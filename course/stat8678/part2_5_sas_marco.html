<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; Writing SAS Macro Program: Using One Sample Variance Test/CI as Example – STAT 8678 - SAS Programming &amp; Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./part2_chi_square.html" rel="next">
<link href="./part2_4_1sample_proportion_test.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-22e83d4e5eff2a99ccc45532742ac980.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="custom-callouts.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STAT 8678 - SAS Programming &amp; Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/chikuang/Teaching-Stat8678"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="././STAT-8678---SAS-Programming---Data-Analysis.pdf"> <i class="bi bi-file-pdf" role="img" aria-label="Download PDF">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2_1_intro_inference1.html">Statistical Analysis</a></li><li class="breadcrumb-item"><a href="./part2_5_sas_marco.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Writing SAS Macro Program: Using One Sample Variance Test/CI as Example</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_1_intro_operation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Basic SAS Operation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_2_sas_syntax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Working with SAS Syntax</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_3_import_export.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Import and Export Dataset</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_4_rv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_1_intro_inference1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Statistical Inference I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_2_intro_inference2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Statistical Inference II</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_3_1sample_nonparametric_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">One Sample Nonparametric Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_4_1sample_proportion_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">One Sample Proportion Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_5_sas_marco.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Writing SAS Macro Program: Using One Sample Variance Test/CI as Example</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_chi_square.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><span class="math inline">\(\chi^2\)</span> Goodness of Fit Test</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation"><span class="header-section-number">9.1</span> Motivation</a>
  <ul class="collapse">
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">9.1.1</span> Examples</a></li>
  </ul></li>
  <li><a href="#sas-macro-program" id="toc-sas-macro-program" class="nav-link" data-scroll-target="#sas-macro-program"><span class="header-section-number">9.2</span> SAS Macro Program</a></li>
  <li><a href="#how-macros-work" id="toc-how-macros-work" class="nav-link" data-scroll-target="#how-macros-work"><span class="header-section-number">9.3</span> How Macros Work</a></li>
  <li><a href="#designing-your-own-macros" id="toc-designing-your-own-macros" class="nav-link" data-scroll-target="#designing-your-own-macros"><span class="header-section-number">9.4</span> Designing Your Own Macros</a>
  <ul class="collapse">
  <li><a href="#macros-vs.-macro-variables" id="toc-macros-vs.-macro-variables" class="nav-link" data-scroll-target="#macros-vs.-macro-variables"><span class="header-section-number">9.4.1</span> Macros vs.&nbsp;Macro Variables</a></li>
  </ul></li>
  <li><a href="#macros-vs.-macro-variables-1" id="toc-macros-vs.-macro-variables-1" class="nav-link" data-scroll-target="#macros-vs.-macro-variables-1"><span class="header-section-number">9.5</span> Macros vs.&nbsp;Macro Variables</a>
  <ul class="collapse">
  <li><a href="#how-the-macro-processor-works" id="toc-how-the-macro-processor-works" class="nav-link" data-scroll-target="#how-the-macro-processor-works"><span class="header-section-number">9.5.1</span> How the Macro Processor Works</a></li>
  <li><a href="#naming-conventions" id="toc-naming-conventions" class="nav-link" data-scroll-target="#naming-conventions"><span class="header-section-number">9.5.2</span> Naming Conventions</a></li>
  <li><a href="#macro-variables" id="toc-macro-variables" class="nav-link" data-scroll-target="#macro-variables"><span class="header-section-number">9.5.3</span> Macro Variables</a></li>
  <li><a href="#macros" id="toc-macros" class="nav-link" data-scroll-target="#macros"><span class="header-section-number">9.5.4</span> Macros</a></li>
  </ul></li>
  <li><a href="#think-globally-and-locally-scope-of-macro-variables" id="toc-think-globally-and-locally-scope-of-macro-variables" class="nav-link" data-scroll-target="#think-globally-and-locally-scope-of-macro-variables"><span class="header-section-number">9.6</span> Think Globally and Locally: Scope of Macro Variables</a>
  <ul class="collapse">
  <li><a href="#local-macro-variables" id="toc-local-macro-variables" class="nav-link" data-scroll-target="#local-macro-variables"><span class="header-section-number">9.6.1</span> Local Macro Variables</a></li>
  <li><a href="#global-macro-variables" id="toc-global-macro-variables" class="nav-link" data-scroll-target="#global-macro-variables"><span class="header-section-number">9.6.2</span> Global Macro Variables</a></li>
  <li><a href="#common-mistakes-to-avoid" id="toc-common-mistakes-to-avoid" class="nav-link" data-scroll-target="#common-mistakes-to-avoid"><span class="header-section-number">9.6.3</span> Common Mistakes to Avoid</a></li>
  </ul></li>
  <li><a href="#you-may-quote-me-on-that" id="toc-you-may-quote-me-on-that" class="nav-link" data-scroll-target="#you-may-quote-me-on-that"><span class="header-section-number">9.7</span> You May Quote Me on That</a></li>
  <li><a href="#substituting-text-with-let" id="toc-substituting-text-with-let" class="nav-link" data-scroll-target="#substituting-text-with-let"><span class="header-section-number">9.8</span> Substituting Text with <code>%LET</code></a></li>
  <li><a href="#a-simple-example-of-writing-sas-macros" id="toc-a-simple-example-of-writing-sas-macros" class="nav-link" data-scroll-target="#a-simple-example-of-writing-sas-macros"><span class="header-section-number">9.9</span> 3. A Simple Example of Writing SAS Macros</a>
  <ul class="collapse">
  <li><a href="#example-1-global-macro-variable" id="toc-example-1-global-macro-variable" class="nav-link" data-scroll-target="#example-1-global-macro-variable"><span class="header-section-number">9.9.1</span> Example 1: Global Macro Variable</a></li>
  <li><a href="#example-1-continued-writing-a-macro-program" id="toc-example-1-continued-writing-a-macro-program" class="nav-link" data-scroll-target="#example-1-continued-writing-a-macro-program"><span class="header-section-number">9.9.2</span> Example 1 (Continued): Writing a Macro Program</a></li>
  </ul></li>
  <li><a href="#topic-9-writing-sas-macro-programs" id="toc-topic-9-writing-sas-macro-programs" class="nav-link" data-scroll-target="#topic-9-writing-sas-macro-programs"><span class="header-section-number">10</span> Topic 9: Writing SAS Macro Programs</a>
  <ul class="collapse">
  <li><a href="#one-sample-variance-test-and-confidence-interval" id="toc-one-sample-variance-test-and-confidence-interval" class="nav-link" data-scroll-target="#one-sample-variance-test-and-confidence-interval"><span class="header-section-number">10.1</span> One-Sample Variance Test and Confidence Interval</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">10.2</span> Learning Objectives</a></li>
  <li><a href="#motivation-why-care-about-variance" id="toc-motivation-why-care-about-variance" class="nav-link" data-scroll-target="#motivation-why-care-about-variance"><span class="header-section-number">10.3</span> 1. Motivation: Why Care About Variance?</a>
  <ul class="collapse">
  <li><a href="#example-1-scuba-diving-depths" id="toc-example-1-scuba-diving-depths" class="nav-link" data-scroll-target="#example-1-scuba-diving-depths"><span class="header-section-number">10.3.1</span> Example 1: SCUBA Diving Depths</a></li>
  <li><a href="#example-2-manufacturing-quality" id="toc-example-2-manufacturing-quality" class="nav-link" data-scroll-target="#example-2-manufacturing-quality"><span class="header-section-number">10.3.2</span> Example 2: Manufacturing Quality</a></li>
  </ul></li>
  <li><a href="#statistical-theory-behind-the-test" id="toc-statistical-theory-behind-the-test" class="nav-link" data-scroll-target="#statistical-theory-behind-the-test"><span class="header-section-number">10.4</span> 2. Statistical Theory Behind the Test</a>
  <ul class="collapse">
  <li><a href="#confidence-interval-for-variance" id="toc-confidence-interval-for-variance" class="nav-link" data-scroll-target="#confidence-interval-for-variance"><span class="header-section-number">10.4.1</span> Confidence Interval for Variance</a></li>
  </ul></li>
  <li><a href="#the-problem-in-sas" id="toc-the-problem-in-sas" class="nav-link" data-scroll-target="#the-problem-in-sas"><span class="header-section-number">10.5</span> 3. The Problem in SAS</a></li>
  <li><a href="#what-is-a-sas-macro" id="toc-what-is-a-sas-macro" class="nav-link" data-scroll-target="#what-is-a-sas-macro"><span class="header-section-number">10.6</span> 4. What Is a SAS Macro?</a>
  <ul class="collapse">
  <li><a href="#why-use-macros" id="toc-why-use-macros" class="nav-link" data-scroll-target="#why-use-macros"><span class="header-section-number">10.6.1</span> Why Use Macros?</a></li>
  </ul></li>
  <li><a href="#how-the-sas-macro-processor-works" id="toc-how-the-sas-macro-processor-works" class="nav-link" data-scroll-target="#how-the-sas-macro-processor-works"><span class="header-section-number">10.7</span> 5. How the SAS Macro Processor Works</a></li>
  <li><a href="#macros-vs.-macro-variables-2" id="toc-macros-vs.-macro-variables-2" class="nav-link" data-scroll-target="#macros-vs.-macro-variables-2"><span class="header-section-number">10.8</span> 6. Macros vs.&nbsp;Macro Variables</a>
  <ul class="collapse">
  <li><a href="#macro-variables-1" id="toc-macro-variables-1" class="nav-link" data-scroll-target="#macro-variables-1"><span class="header-section-number">10.8.1</span> Macro Variables</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2_1_intro_inference1.html">Statistical Analysis</a></li><li class="breadcrumb-item"><a href="./part2_5_sas_marco.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Writing SAS Macro Program: Using One Sample Variance Test/CI as Example</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Writing SAS Macro Program: Using One Sample Variance Test/CI as Example</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>Learning Objectives</p>
<ol type="1">
<li>Apply hypothesis testing and confidence interval construction for <strong>one population variance</strong>.</li>
<li>Use this example to motivate <strong>writing reusable SAS macro programs</strong>.</li>
</ol>
</blockquote>
<section id="motivation" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">9.1</span> Motivation</h2>
<p>In many applications, we may care more about the <strong>population variance</strong> <span class="math inline">\(\sigma^2\)</span> than the population mean <span class="math inline">\(\mu\)</span>. For instance, in a manufacturing process, a <strong>large variance</strong> in product measurements indicates unstable quality, even if the mean is acceptable. This is not the only instance, as there are many interesting scientific questions that involve the population variance both in academia and in industry.</p>
<section id="examples" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="examples"><span class="header-section-number">9.1.1</span> Examples</h3>
<div class="callout-example" title="SCUBA Diving">
<p>A SCUBA instructor records the dive depths of students during checkout. Although everyone should be at the same depth, the instructor is interested in how much the depths vary.</p>
<p>The instructor believes the standard deviation is <strong>3 feet</strong>, while the assistant thinks it is <strong>less than 3 feet</strong>.</p>
<p>The hypotheses are:</p>
<p><span class="math display">\[
  H_0 : \sigma^2 = 3^2
  \qquad \text{vs} \qquad
  H_1 : \sigma^2 &lt; 3^2
  \]</span></p>
</div>
<div class="callout-example" title="Manufacturing Quality">
<p>A company produces metal pipes of a standard length. Twenty years ago, the pipe lengths were normally distributed with standard deviation <strong>1.1 cm</strong>.</p>
<p>The company now tests a random sample of <strong>30 pipes</strong> and wants to construct a <strong>95% confidence interval</strong> for <span class="math inline">\(\sigma^2\)</span> to determine whether the production quality has changed.</p>
</div>
<p>For the examples above, the quantity of the interest is the population variance. But we need something to estiamte it. Let <span class="math inline">\(s^2\)</span> denote the sample variance. Then the pivotal quantity</p>
<p><span class="math display">\[
\frac{(n-1)s^2}{\sigma^2},
\]</span></p>
<p>which follows a chi-square distribution:</p>
<p><span class="math display">\[
\frac{(n-1)s^2}{\sigma^2} \sim \chi^2_{n-1},
\]</span> where</p>
<ul>
<li><span class="math inline">\(n\)</span> : sample size<br>
</li>
<li><span class="math inline">\(s^2\)</span> : sample variance<br>
</li>
<li><span class="math inline">\(\sigma^2\)</span> : population variance</li>
</ul>
<p>You may think that <span class="math inline">\(s\)</span> as the randomvariable in this test. The distribution is called chi-square distribution which depends on a parameter named the <em>degrees of freedom</em> denoted by <span class="math inline">\(\mathrm{df}=n-1\)</span>. A test of a single variance may be right-tailed, left-tailed or two-sided. This chi-square result is the foundation for both <strong>confidence intervals</strong> and <strong>hypothesis tests</strong> for <span class="math inline">\(\sigma^2\)</span>.</p>
<div id="callout-1" class="callout callout-style-default callout-note callout-titled" title="Note">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <span class="math inline">\((1-\alpha)\times 100\%\)</span> confidence interval for the population variance is</p>
<p><span class="math display">\[
\left(
\frac{(n-1)s^2}{\chi^2_{1-\alpha/2,\;n-1}},
\;
\frac{(n-1)s^2}{\chi^2_{\alpha/2,\;n-1}}
\right),
\]</span></p>
<p>where <span class="math inline">\(\chi^2_{p,\;n-1}\)</span> denotes the <span class="math inline">\(p\)</span>-th quantile of the <span class="math inline">\(\chi^2_{n-1}\)</span> distribution.</p>
<p>I won’t expect you to know the expression here for now.</p>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Problem</strong></p>
<p>Unfortunately, if you check the built-in SAS procedures, you will find that <strong>there is no basic procedure</strong> that directly handles the <strong>one-sample variance inference problem</strong>.</p>
<p>The good news is that SAS provides a powerful <strong>MACRO programming language</strong>, which allows us to <strong>write our own SAS procedures</strong>.</p>
</blockquote>
</section>
</section>
<section id="sas-macro-program" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="sas-macro-program"><span class="header-section-number">9.2</span> SAS Macro Program</h2>
<p>When you write a program that will be run <strong>repeatedly</strong>, you may want to seriously consider using <strong>macros</strong>, because:</p>
<ul>
<li><p><strong>MARCROS allow centralized changes</strong>:<br>
You can make a change in one location, and SAS will cascade that change throughout your program.</p></li>
<li><p><strong>MACROS promote code reuse</strong>:<br>
You can write a section of code once and reuse it many times, either within the same program or across different programs.</p></li>
<li><p><strong>MARCROS enable data-driven programming</strong>:<br>
SAS can decide what actions to take based on actual data values.</p></li>
</ul>
<p>In general, macro code takes <strong>longer to write and debug</strong> than standard SAS code. Therefore, macros are usually <strong>not recommended</strong> for programs that will only be run a few times.</p>
<p>However, if you find yourself writing <strong>similar code repeatedly</strong>, macros can significantly improve efficiency and reduce errors.</p>
<p>Macros can help in several ways:</p>
<ol type="1">
<li>You can make a <strong>single small change</strong>, and SAS will propagate that change throughout your program.</li>
<li>You can <strong>reuse code blocks</strong>, avoiding duplication.</li>
<li>You can build <strong>data-driven programs</strong>, allowing SAS to adapt automatically to different datasets or inputs.</li>
</ol>
</section>
<section id="how-macros-work" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="how-macros-work"><span class="header-section-number">9.3</span> How Macros Work</h2>
<p>When you submit a standard SAS program, SAS <strong>compiles and executes it immediately</strong>. When you write macro code, there is an <strong>additional step</strong>:</p>
<ul>
<li>SAS first sends MARCO statements to the <strong>macro processor</strong>.</li>
<li>The macro processor <strong>resolves the macro code</strong>, generating standard SAS code.</li>
<li>SAS then compiles and executes the generated code.</li>
</ul>
<p>Because you are writing a program that <strong>writes another program</strong>, this process is sometimes referred to as <strong>meta-programming</strong>.</p>
</section>
<section id="designing-your-own-macros" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="designing-your-own-macros"><span class="header-section-number">9.4</span> Designing Your Own Macros</h2>
<p>To design effective SAS macros, we need to understand two fundamental concepts:</p>
<section id="macros-vs.-macro-variables" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="macros-vs.-macro-variables"><span class="header-section-number">9.4.1</span> Macros vs.&nbsp;Macro Variables</h3>
<p>As you construct macro programs, you will work with two basic building blocks:</p>
<ul>
<li><strong>MACROS</strong> v.s.</li>
<li><strong>MACRO variables</strong></li>
</ul>
<p>We will study each of these in detail in the next section.</p>
</section>
</section>
<section id="macros-vs.-macro-variables-1" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="macros-vs.-macro-variables-1"><span class="header-section-number">9.5</span> Macros vs.&nbsp;Macro Variables</h2>
<p>To design your own SAS macros, we need to clearly distinguish between <strong>macros</strong> and <strong>macro variables</strong>.<br>
These are the two basic building blocks of SAS macro programming.</p>
<hr>
<section id="how-the-macro-processor-works" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="how-the-macro-processor-works"><span class="header-section-number">9.5.1</span> How the Macro Processor Works</h3>
<p>Conceptually, the workflow looks like this:</p>
<ul>
<li>You write <strong>macro code</strong></li>
<li>The <strong>macro processor</strong> resolves it</li>
<li>The output is <strong>ordinary SAS code</strong>, which is then compiled and executed</li>
</ul>
<hr>
</section>
<section id="naming-conventions" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="naming-conventions"><span class="header-section-number">9.5.2</span> Naming Conventions</h3>
<p>You can tell macros and macro variables apart by their prefixes:</p>
<ul>
<li><strong>Macro variables</strong> start with an ampersand: <code>&amp;</code></li>
<li><strong>Macros</strong> start with a percent sign: <code>%</code></li>
</ul>
<p>Examples: - <code>&amp;alpha</code>, <code>&amp;n</code> - <code>%myMacro</code>, <code>%DO</code>, <code>%IF</code></p>
<hr>
</section>
<section id="macro-variables" class="level3" data-number="9.5.3">
<h3 data-number="9.5.3" class="anchored" data-anchor-id="macro-variables"><span class="header-section-number">9.5.3</span> Macro Variables</h3>
<p>A <strong>macro variable</strong> is similar to a data variable, but with important differences:</p>
<ul>
<li>It does <strong>not belong to a dataset</strong></li>
<li>It has <strong>only one value</strong></li>
<li>That value is <strong>always character</strong></li>
<li>The value is <strong>substituted directly into your program</strong></li>
</ul>
<p>A macro variable’s value can be: - A variable name - A number - Text - Any string you want substituted into your SAS code</p>
<hr>
</section>
<section id="macros" class="level3" data-number="9.5.4">
<h3 data-number="9.5.4" class="anchored" data-anchor-id="macros"><span class="header-section-number">9.5.4</span> Macros</h3>
<p>A <strong>macro</strong> is a larger unit of code that can contain:</p>
<ul>
<li>DATA steps</li>
<li>PROC steps</li>
<li>Macro logic such as<br>
<code>%IF–%THEN–%ELSE</code>, <code>%DO–%END</code></li>
</ul>
<p>Macros often—but not always—use macro variables.</p>
<hr>
</section>
</section>
<section id="think-globally-and-locally-scope-of-macro-variables" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="think-globally-and-locally-scope-of-macro-variables"><span class="header-section-number">9.6</span> Think Globally and Locally: Scope of Macro Variables</h2>
<p>Macro variables come in two scopes:</p>
<ul>
<li><strong>Local macro variables</strong></li>
<li><strong>Global macro variables</strong></li>
</ul>
<section id="local-macro-variables" class="level3" data-number="9.6.1">
<h3 data-number="9.6.1" class="anchored" data-anchor-id="local-macro-variables"><span class="header-section-number">9.6.1</span> Local Macro Variables</h3>
<ul>
<li>Defined <strong>inside a macro</strong></li>
<li>Exist <strong>only within that macro</strong></li>
<li>Cannot be referenced outside the macro</li>
</ul>
</section>
<section id="global-macro-variables" class="level3" data-number="9.6.2">
<h3 data-number="9.6.2" class="anchored" data-anchor-id="global-macro-variables"><span class="header-section-number">9.6.2</span> Global Macro Variables</h3>
<ul>
<li>Defined in <strong>open code</strong> (outside any macro)</li>
<li>Can be used <strong>anywhere in the program</strong></li>
</ul>
</section>
<section id="common-mistakes-to-avoid" class="level3" data-number="9.6.3">
<h3 data-number="9.6.3" class="anchored" data-anchor-id="common-mistakes-to-avoid"><span class="header-section-number">9.6.3</span> Common Mistakes to Avoid</h3>
<ul>
<li>Using a local macro variable outside its macro</li>
<li>Accidentally creating <strong>both local and global macro variables with the same name</strong></li>
</ul>
<p>Keeping scope in mind will save you a lot of debugging time.</p>
<hr>
</section>
</section>
<section id="you-may-quote-me-on-that" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="you-may-quote-me-on-that"><span class="header-section-number">9.7</span> You May Quote Me on That</h2>
<p>The macro processor <strong>does not resolve macro references inside single quotes</strong>.</p>
<ul>
<li>❌ <code>'&amp;var'</code> → macro not resolved</li>
<li>✅ <code>"&amp;var"</code> → macro resolved</li>
</ul>
<p><strong>Rule of thumb:</strong><br>
Use <strong>double quotes</strong> when quoted strings contain macro variables.</p>
<hr>
</section>
<section id="substituting-text-with-let" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="substituting-text-with-let"><span class="header-section-number">9.8</span> Substituting Text with <code>%LET</code></h2>
<p>The <code>%LET</code> statement assigns a value to a macro variable.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>%LET alpha <span class="ot">=</span> <span class="fl">0.05</span>;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>%MACRO <span class="fu">macro_name</span>(param1, param2, ..., paramk);</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">/</span><span class="er">*</span> macro code <span class="sc">*</span><span class="er">/</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>%MEND macro_name;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="a-simple-example-of-writing-sas-macros" class="level2" data-number="9.9">
<h2 data-number="9.9" class="anchored" data-anchor-id="a-simple-example-of-writing-sas-macros"><span class="header-section-number">9.9</span> 3. A Simple Example of Writing SAS Macros</h2>
<p>Before writing our own macros, let us first understand how <strong>macro variables</strong> work through a simple example.</p>
<hr>
<section id="example-1-global-macro-variable" class="level3" data-number="9.9.1">
<h3 data-number="9.9.1" class="anchored" data-anchor-id="example-1-global-macro-variable"><span class="header-section-number">9.9.1</span> Example 1: Global Macro Variable</h3>
<p>SAS provides a built-in <strong>global macro variable</strong> called <code>SYSDATE</code>, which represents the system date.</p>
<p>Suppose we want to print the system date automatically in the title of a SAS report every time the report is generated. The advantage is that we do <strong>not</strong> need to manually update the date in the code.</p>
<p>We use the built-in SAS dataset <code>CARS</code> from the <code>SASHELP</code> library.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA<span class="ot">=</span>SASHELP.CARS;</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  WHERE MAKE <span class="ot">=</span> <span class="st">'Audi'</span> AND TYPE <span class="ot">=</span> <span class="st">'Sports'</span>;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Example 1 (Continued): Local Macro Variables</p>
<p>Macro variables are referenced in SAS statements using the ampersand (&amp;) character.</p>
<p>Now suppose we want our program to be more flexible. Instead of hard-coding the car MAKE and TYPE, we define macro variables so that we can easily change them without modifying multiple lines of code.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>%LET MAKE_NAME <span class="ot">=</span> Audi;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>%LET TYPE_NAME <span class="ot">=</span> Sports;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA<span class="ot">=</span>SASHELP.CARS;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  WHERE MAKE <span class="ot">=</span> <span class="st">"&amp;MAKE_NAME"</span> AND TYPE <span class="ot">=</span> <span class="st">"&amp;TYPE_NAME"</span>;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Reusing the Same Program with Different Values</p>
<p>Now, suppose we want to view Audi vehicles of type Wagon. We only need to change one line of code.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>%LET MAKE_NAME <span class="ot">=</span> Audi;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>%LET TYPE_NAME <span class="ot">=</span> Wagon;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA<span class="ot">=</span>SASHELP.CARS;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  WHERE MAKE <span class="ot">=</span> <span class="st">"&amp;MAKE_NAME"</span> AND TYPE <span class="ot">=</span> <span class="st">"&amp;TYPE_NAME"</span>;</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="example-1-continued-writing-a-macro-program" class="level3" data-number="9.9.2">
<h3 data-number="9.9.2" class="anchored" data-anchor-id="example-1-continued-writing-a-macro-program"><span class="header-section-number">9.9.2</span> Example 1 (Continued): Writing a Macro Program</h3>
<p>So far, we have used macro variables to make our SAS programs more flexible.<br>
Now we take one more step forward and define a <strong>macro program</strong>, which is a reusable block of SAS code.</p>
<hr>
<section id="defining-a-macro" class="level4" data-number="9.9.2.1">
<h4 data-number="9.9.2.1" class="anchored" data-anchor-id="defining-a-macro"><span class="header-section-number">9.9.2.1</span> Defining a Macro</h4>
<p>The following program defines a macro called <code>show_result</code>.<br>
This macro takes two arguments: - <code>make_</code>: the car manufacturer - <code>type_</code>: the vehicle type</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>%MACRO <span class="fu">show_result</span>(make_, type_);</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA<span class="ot">=</span>SASHELP.CARS;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  WHERE MAKE <span class="ot">=</span> <span class="st">"&amp;make_"</span> AND TYPE <span class="ot">=</span> <span class="st">"&amp;type_"</span>;</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>RUN;</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>%MEND;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Calling a Macro Once a macro is defined, it can be called just like a function.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>%<span class="fu">show_result</span>(BMW, SUV);</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Why Use Macro Programs? Macro programs allow you to: • Avoid rewriting the same code repeatedly • Centralize logic in one place • Make programs easier to maintain and extend • Write data-driven and parameterized SAS programs</p>
<p>This idea becomes especially powerful when we need to repeat the same analysis for many datasets or parameter values.</p>
<ol start="4" type="1">
<li>Revisit the One-Sample Variance Test</li>
</ol>
<p>As discussed earlier, SAS does not provide a built-in procedure for conducting one-sample variance inference (confidence intervals or hypothesis tests).</p>
<p>However, SAS allows us to overcome this limitation by writing our own macro procedures.</p>
<p>Fortunately, a one-sample variance inference macro is commonly used and can be written in a general form. In this course, we will use a macro named vartest.sas, which is shared in the course materials.</p>
<p>In the next section, we will: • Examine the structure of the variance-test macro • Understand how macro parameters control the analysis • Apply the macro to real data examples</p>
<hr>
</section>
</section>
</section>
<section id="topic-9-writing-sas-macro-programs" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Topic 9: Writing SAS Macro Programs</h1>
<section id="one-sample-variance-test-and-confidence-interval" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="one-sample-variance-test-and-confidence-interval"><span class="header-section-number">10.1</span> One-Sample Variance Test and Confidence Interval</h2>
<p><strong>STAT 8678 — SAS Programming</strong><br>
Spring 2026</p>
<hr>
</section>
<section id="learning-objectives" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">10.2</span> Learning Objectives</h2>
<p>By the end of this lecture, you should be able to:</p>
<ul>
<li>Understand <strong>why SAS macros are needed</strong> for certain inference problems<br>
</li>
<li>Distinguish between <strong>macros</strong> and <strong>macro variables</strong><br>
</li>
<li>Explain how the <strong>SAS macro processor</strong> works<br>
</li>
<li>Write and interpret a <strong>simple SAS macro</strong><br>
</li>
<li>Use a macro to perform <strong>one-sample variance inference</strong>, including:
<ul>
<li>Hypothesis testing<br>
</li>
<li>Confidence intervals</li>
</ul></li>
</ul>
<hr>
</section>
<section id="motivation-why-care-about-variance" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="motivation-why-care-about-variance"><span class="header-section-number">10.3</span> 1. Motivation: Why Care About Variance?</h2>
<p>In many applications, <strong>variability</strong> is more important than the mean.</p>
<p>Examples include:</p>
<ul>
<li><strong>Manufacturing</strong>: Large variance in product dimensions indicates unstable quality.<br>
</li>
<li><strong>Environmental monitoring</strong>: High variance may signal abnormal conditions.<br>
</li>
<li><strong>Education or training</strong>: Inconsistent outcomes may be more concerning than average performance.</li>
</ul>
<p>We denote the population variance by <span class="math inline">\(\sigma^2\)</span>.</p>
<hr>
<section id="example-1-scuba-diving-depths" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="example-1-scuba-diving-depths"><span class="header-section-number">10.3.1</span> Example 1: SCUBA Diving Depths</h3>
<p>An instructor records dive depths for students:</p>
<ul>
<li>The instructor believes the <strong>standard deviation is 3 feet</strong>.<br>
</li>
<li>The assistant believes the variability is <strong>less than 3 feet</strong>.</li>
</ul>
<p>The hypotheses are:</p>
<p><span class="math display">\[
H_0: \sigma^2 = 3^2
\qquad \text{vs.} \qquad
H_1: \sigma^2 &lt; 3^2
\]</span></p>
<hr>
</section>
<section id="example-2-manufacturing-quality" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="example-2-manufacturing-quality"><span class="header-section-number">10.3.2</span> Example 2: Manufacturing Quality</h3>
<ul>
<li>Pipe lengths were historically normally distributed.<br>
</li>
<li>The standard deviation was <strong>1.1 cm</strong>.<br>
</li>
<li>A random sample of <span class="math inline">\(n = 30\)</span> pipes is collected.<br>
</li>
<li>The goal is to construct a <strong>95% confidence interval for <span class="math inline">\(\sigma^2\)</span></strong>.</li>
</ul>
<hr>
</section>
</section>
<section id="statistical-theory-behind-the-test" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="statistical-theory-behind-the-test"><span class="header-section-number">10.4</span> 2. Statistical Theory Behind the Test</h2>
<p>If the data are normally distributed, the following pivotal quantity holds:</p>
<p><span class="math display">\[
\frac{(n-1)s^2}{\sigma^2} \sim \chi^2_{n-1}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(n\)</span> is the sample size<br>
</li>
<li><span class="math inline">\(s^2\)</span> is the sample variance</li>
</ul>
<p>This result allows us to construct both:</p>
<ul>
<li><strong>Hypothesis tests</strong><br>
</li>
<li><strong>Confidence intervals</strong> for <span class="math inline">\(\sigma^2\)</span> and <span class="math inline">\(\sigma\)</span></li>
</ul>
<hr>
<section id="confidence-interval-for-variance" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="confidence-interval-for-variance"><span class="header-section-number">10.4.1</span> Confidence Interval for Variance</h3>
<p>A <span class="math inline">\((1-\alpha)\times 100\%\)</span> confidence interval for <span class="math inline">\(\sigma^2\)</span> is:</p>
<p><span class="math display">\[
\left[
\frac{(n-1)s^2}{\chi^2_{1-\alpha/2}},
\;
\frac{(n-1)s^2}{\chi^2_{\alpha/2}}
\right]
\]</span></p>
<p>A confidence interval for <span class="math inline">\(\sigma\)</span> is obtained by taking square roots of the bounds.</p>
<hr>
</section>
</section>
<section id="the-problem-in-sas" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="the-problem-in-sas"><span class="header-section-number">10.5</span> 3. The Problem in SAS</h2>
<p>There is <strong>no built-in SAS procedure</strong> for one-sample variance testing or confidence interval construction.</p>
<ul>
<li>No <code>PROC VARTEST</code><br>
</li>
<li>No direct equivalent to <code>PROC TTEST</code> for variance</li>
</ul>
<p><strong>Solution:</strong> Write our own procedure using <strong>SAS macros</strong>.</p>
<hr>
</section>
<section id="what-is-a-sas-macro" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="what-is-a-sas-macro"><span class="header-section-number">10.6</span> 4. What Is a SAS Macro?</h2>
<p>A <strong>macro</strong> is a program that <strong>writes SAS code</strong>.</p>
<p>Key idea:</p>
<blockquote class="blockquote">
<p>You are writing a program that generates another program.</p>
</blockquote>
<p>This is sometimes called <strong>meta-programming</strong>.</p>
<hr>
<section id="why-use-macros" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="why-use-macros"><span class="header-section-number">10.6.1</span> Why Use Macros?</h3>
<p>Macros allow you to:</p>
<ul>
<li>Make changes in <strong>one location</strong> that affect the entire program<br>
</li>
<li><strong>Reuse code</strong> without copy-and-paste<br>
</li>
<li>Write <strong>data-driven</strong> programs<br>
</li>
<li>Automate repetitive analyses</li>
</ul>
<hr>
</section>
</section>
<section id="how-the-sas-macro-processor-works" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="how-the-sas-macro-processor-works"><span class="header-section-number">10.7</span> 5. How the SAS Macro Processor Works</h2>
<p>Conceptually:</p>
<p>Macro statements ↓ Macro processor ↓ Standard SAS code</p>
<p>Execution steps:</p>
<ol type="1">
<li>SAS sends macro code to the <strong>macro processor</strong><br>
</li>
<li>Macros are <strong>resolved</strong><br>
</li>
<li>The resulting SAS code is compiled and executed</li>
</ol>
<hr>
</section>
<section id="macros-vs.-macro-variables-2" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="macros-vs.-macro-variables-2"><span class="header-section-number">10.8</span> 6. Macros vs.&nbsp;Macro Variables</h2>
<section id="macro-variables-1" class="level3" data-number="10.8.1">
<h3 data-number="10.8.1" class="anchored" data-anchor-id="macro-variables-1"><span class="header-section-number">10.8.1</span> Macro Variables</h3>
<ul>
<li>Begin with <code>&amp;</code><br>
</li>
<li>Always <strong>character values</strong><br>
</li>
<li>Do <strong>not</strong> belong to a dataset<br>
</li>
<li>Used for <strong>text substitution</strong></li>
</ul>
<p>Example:</p>
<pre class="sas"><code>%LET alpha = 0.05;</code></pre>
<p>Macros • Begin with % • Can contain: • DATA steps • PROC steps • Macro logic (%IF, %DO, %END) • Often use macro variables internally</p>
<p>Example:</p>
<p>%MACRO mymacro(); PROC PRINT DATA=example; RUN; %MEND;</p>
<ol start="7" type="1">
<li>Scope: Global vs.&nbsp;Local Macro Variables</li>
</ol>
<p>Macro variables can be: • Global: defined outside macros • Local: defined inside macros</p>
<p>Rules: • Global macro variables can be used anywhere • Local macro variables can only be used inside the macro that defines them</p>
<p>Common mistakes include: • Using a local macro variable outside its macro • Accidentally creating local and global variables with the same name</p>
<p>⸻</p>
<ol start="8" type="1">
<li>Substituting Text with %LET</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>%<span class="fu">vartest</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">version =</span> <span class="fl">1.1</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> mydata,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">var     =</span> response,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha   =</span> <span class="fl">0.05</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma0  =</span> <span class="fl">1.1</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./part2_4_1sample_proportion_test.html" class="pagination-link" aria-label="One Sample Proportion Test">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">One Sample Proportion Test</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./part2_chi_square.html" class="pagination-link" aria-label="$\chi^2$ Goodness of Fit Test">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><span class="math inline">\(\chi^2\)</span> Goodness of Fit Test</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>