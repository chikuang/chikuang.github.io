<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; SAS Macro Program in One Sample Variance Problem – STAT 8678 - SAS Programming &amp; Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./part2_6_chi-square.html" rel="next">
<link href="./part2_4_1sample_proportion_test.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-22e83d4e5eff2a99ccc45532742ac980.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="custom-callouts.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STAT 8678 - SAS Programming &amp; Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/chikuang/Teaching-Stat8678"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="././STAT-8678---SAS-Programming---Data-Analysis.pdf"> <i class="bi bi-file-pdf" role="img" aria-label="Download PDF">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2_1_intro_inference1.html">Statistical Analysis</a></li><li class="breadcrumb-item"><a href="./part2_5_sas_marco.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">SAS Macro Program in One Sample Variance Problem</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_1_intro_operation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Basic SAS Operation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_2_sas_syntax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Working with SAS Syntax</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_3_import_export.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Import and Export Dataset</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part1_4_rv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_1_intro_inference1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Statistical Inference I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_2_intro_inference2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Statistical Inference II</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_3_1sample_nonparametric_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">One Sample Nonparametric Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_4_1sample_proportion_test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">One Sample Proportion Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_5_sas_marco.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">SAS Macro Program in One Sample Variance Problem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_6_chi-square.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><span class="math inline">\(\chi^2\)</span> Goodness of Fit Test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part2_7_power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Power Analysis with application in one sample <span class="math inline">\(t\)</span>-test</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation"><span class="header-section-number">9.1</span> Motivation</a>
  <ul class="collapse">
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">9.1.1</span> Examples</a></li>
  </ul></li>
  <li><a href="#sas-macro-program" id="toc-sas-macro-program" class="nav-link" data-scroll-target="#sas-macro-program"><span class="header-section-number">9.2</span> SAS Macro Program</a></li>
  <li><a href="#how-macros-work" id="toc-how-macros-work" class="nav-link" data-scroll-target="#how-macros-work"><span class="header-section-number">9.3</span> How Macros Work</a></li>
  <li><a href="#designing-your-own-macros" id="toc-designing-your-own-macros" class="nav-link" data-scroll-target="#designing-your-own-macros"><span class="header-section-number">9.4</span> Designing Your Own Macros</a>
  <ul class="collapse">
  <li><a href="#macros-vs.-macro-variables" id="toc-macros-vs.-macro-variables" class="nav-link" data-scroll-target="#macros-vs.-macro-variables"><span class="header-section-number">9.4.1</span> Macros vs.&nbsp;Macro Variables</a></li>
  </ul></li>
  <li><a href="#think-globally-and-locally-scope-of-macro-variables" id="toc-think-globally-and-locally-scope-of-macro-variables" class="nav-link" data-scroll-target="#think-globally-and-locally-scope-of-macro-variables"><span class="header-section-number">9.5</span> Think Globally and Locally: Scope of Macro Variables</a>
  <ul class="collapse">
  <li><a href="#local-macro-variables" id="toc-local-macro-variables" class="nav-link" data-scroll-target="#local-macro-variables"><span class="header-section-number">9.5.1</span> Local Macro Variables</a></li>
  <li><a href="#global-macro-variables" id="toc-global-macro-variables" class="nav-link" data-scroll-target="#global-macro-variables"><span class="header-section-number">9.5.2</span> Global Macro Variables</a></li>
  <li><a href="#common-mistakes-to-avoid" id="toc-common-mistakes-to-avoid" class="nav-link" data-scroll-target="#common-mistakes-to-avoid"><span class="header-section-number">9.5.3</span> Common Mistakes to Avoid</a></li>
  </ul></li>
  <li><a href="#writing-sas-macros-with-car-dataset" id="toc-writing-sas-macros-with-car-dataset" class="nav-link" data-scroll-target="#writing-sas-macros-with-car-dataset"><span class="header-section-number">9.6</span> Writing SAS Macros with Car dataset</a></li>
  <li><a href="#revisit-the-one-sample-variance-test" id="toc-revisit-the-one-sample-variance-test" class="nav-link" data-scroll-target="#revisit-the-one-sample-variance-test"><span class="header-section-number">9.7</span> Revisit the One-Sample Variance Test</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2_1_intro_inference1.html">Statistical Analysis</a></li><li class="breadcrumb-item"><a href="./part2_5_sas_marco.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">SAS Macro Program in One Sample Variance Problem</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">SAS Macro Program in One Sample Variance Problem</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>Learning Objectives</p>
<ol type="1">
<li>Apply hypothesis testing and confidence interval construction for <strong>one population variance</strong>.</li>
<li>Use this example to motivate <strong>writing reusable SAS macro programs</strong>.</li>
</ol>
</blockquote>
<section id="motivation" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">9.1</span> Motivation</h2>
<p>In many applications, we may care more about the <strong>population variance</strong> <span class="math inline">\(\sigma^2\)</span> than the population mean <span class="math inline">\(\mu\)</span>. For instance, in a manufacturing process, a <strong>large variance</strong> in product measurements indicates unstable quality, even if the mean is acceptable. This is not the only instance, as there are many interesting scientific questions that involve the population variance both in academia and in industry.</p>
<section id="examples" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="examples"><span class="header-section-number">9.1.1</span> Examples</h3>
<div class="callout-example" title="SCUBA Diving">
<p>A SCUBA instructor records the dive depths of students during checkout. Although everyone should be at the same depth, the instructor is interested in how much the depths vary.</p>
<p>The instructor believes the standard deviation is <strong>3 feet</strong>, while the assistant thinks it is <strong>less than 3 feet</strong>.</p>
<p>The hypotheses are:</p>
<p><span class="math display">\[
  H_0 : \sigma^2 = 3^2
  \qquad \text{vs} \qquad
  H_1 : \sigma^2 &lt; 3^2
  \]</span></p>
</div>
<div class="callout-example" title="Manufacturing Quality">
<p>A company produces metal pipes of a standard length. Twenty years ago, the pipe lengths were normally distributed with standard deviation <strong>1.1 cm</strong>.</p>
<p>The company now tests a random sample of <strong>30 pipes</strong> and wants to construct a <strong>95% confidence interval</strong> for <span class="math inline">\(\sigma^2\)</span> to determine whether the production quality has changed.</p>
</div>
<p>For the examples above, the quantity of the interest is the population variance. But we need something to estiamte it. Let <span class="math inline">\(s^2\)</span> denote the sample variance. Then the pivotal quantity</p>
<p><span class="math display">\[
\frac{(n-1)s^2}{\sigma^2},
\]</span></p>
<p>which follows a chi-square distribution:</p>
<p><span class="math display">\[
\frac{(n-1)s^2}{\sigma^2} \sim \chi^2_{n-1},
\]</span> where</p>
<ul>
<li><span class="math inline">\(n\)</span> : sample size<br>
</li>
<li><span class="math inline">\(s^2\)</span> : sample variance<br>
</li>
<li><span class="math inline">\(\sigma^2\)</span> : population variance</li>
</ul>
<p>You may think that <span class="math inline">\(s\)</span> as the randomvariable in this test. The distribution is called chi-square distribution which depends on a parameter named the <em>degrees of freedom</em> denoted by <span class="math inline">\(\mathrm{df}=n-1\)</span>. A test of a single variance may be right-tailed, left-tailed or two-sided. This chi-square result is the foundation for both <strong>confidence intervals</strong> and <strong>hypothesis tests</strong> for <span class="math inline">\(\sigma^2\)</span>.</p>
<div id="callout-1" class="callout callout-style-default callout-note callout-titled" title="Note">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <span class="math inline">\((1-\alpha)\times 100\%\)</span> confidence interval for the population variance is</p>
<p><span class="math display">\[
\left(
\frac{(n-1)s^2}{\chi^2_{1-\alpha/2,\;n-1}},
\;
\frac{(n-1)s^2}{\chi^2_{\alpha/2,\;n-1}}
\right),
\]</span></p>
<p>where <span class="math inline">\(\chi^2_{p,\;n-1}\)</span> denotes the <span class="math inline">\(p\)</span>-th quantile of the <span class="math inline">\(\chi^2_{n-1}\)</span> distribution.</p>
<p>I won’t expect you to know the expression here for now.</p>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Problem</strong></p>
<p>Unfortunately, if you check the built-in SAS procedures, you will find that <strong>there is no basic procedure</strong> that directly handles the <strong>one-sample variance inference problem</strong>.</p>
<p>The good news is that SAS provides a powerful <strong>MACRO programming language</strong>, which allows us to <strong>write our own SAS procedures</strong>.</p>
</blockquote>
</section>
</section>
<section id="sas-macro-program" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="sas-macro-program"><span class="header-section-number">9.2</span> SAS Macro Program</h2>
<p>When you write a program that will be run <strong>repeatedly</strong>, you may want to seriously consider using <strong>macros</strong>, because:</p>
<ul>
<li><p><strong>MARCROS allow centralized changes</strong>:<br>
You can make a change in one location, and SAS will cascade that change throughout your program.</p></li>
<li><p><strong>MACROS promote code reuse</strong>:<br>
You can write a section of code once and reuse it many times, either within the same program or across different programs.</p></li>
<li><p><strong>MARCROS enable data-driven programming</strong>:<br>
SAS can decide what actions to take based on actual data values.</p></li>
</ul>
<p>In general, macro code takes <strong>longer to write and debug</strong> than standard SAS code. Therefore, macros are usually <strong>not recommended</strong> for programs that will only be run a few times.</p>
<p>However, if you find yourself writing <strong>similar code repeatedly</strong>, macros can significantly improve efficiency and reduce errors.</p>
<p>Macros can help in several ways:</p>
<ol type="1">
<li>You can make a <strong>single small change</strong>, and SAS will propagate that change throughout your program.</li>
<li>You can <strong>reuse code blocks</strong>, avoiding duplication.</li>
<li>You can build <strong>data-driven programs</strong>, allowing SAS to adapt automatically to different datasets or inputs.</li>
</ol>
</section>
<section id="how-macros-work" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="how-macros-work"><span class="header-section-number">9.3</span> How Macros Work</h2>
<p>When you submit a standard SAS program, SAS <strong>compiles and executes it immediately</strong>. When you write macro code, there is an <strong>additional step</strong>:</p>
<ul>
<li>SAS first sends MARCO statements to the <strong>macro processor</strong>.</li>
<li>The macro processor <strong>resolves the macro code</strong>, generating standard SAS code.</li>
<li>SAS then compiles and executes the generated code.</li>
</ul>
<p>Because you are writing a program that <strong>writes another program</strong>, this process is sometimes referred to as <strong>meta-programming</strong>.</p>
</section>
<section id="designing-your-own-macros" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="designing-your-own-macros"><span class="header-section-number">9.4</span> Designing Your Own Macros</h2>
<p>To design effective SAS macros, we need to understand two fundamental concepts:</p>
<section id="macros-vs.-macro-variables" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="macros-vs.-macro-variables"><span class="header-section-number">9.4.1</span> Macros vs.&nbsp;Macro Variables</h3>
<p>As you construct macro programs, you will work with two basic building blocks:</p>
<ul>
<li><strong>MACROS</strong> v.s.</li>
<li><strong>MACRO variables</strong></li>
</ul>
<p>To design your own SAS macros, we need to clearly distinguish between <strong>macros</strong> and <strong>macro variables</strong>. These are the two basic building blocks of SAS macro programming.</p>
<p>Conceptually, the workflow looks like this:</p>
<ul>
<li>You write <strong>macro code</strong></li>
<li>The <strong>macro processor</strong> resolves it</li>
<li>The output is <strong>ordinary SAS code</strong>, which is then compiled and executed</li>
</ul>
<p><strong>Naming Conventions</strong></p>
<p>You can tell macros and macro variables apart by their prefixes:</p>
<ul>
<li><strong>Macro variables</strong> start with an ampersand: <code>&amp;</code></li>
<li><strong>Macros</strong> start with a percent sign: <code>%</code></li>
</ul>
<p>Examples:</p>
<ul>
<li><code>&amp;alpha</code>, <code>&amp;n</code></li>
<li><code>%myMacro</code>, <code>%DO</code>, <code>%IF</code></li>
</ul>
<p><strong>Macro Variables</strong></p>
<p>A <strong>macro variable</strong> is similar to a data variable, but with important differences:</p>
<ul>
<li>It does <strong>not belong to a dataset</strong></li>
<li>It has <strong>only one value</strong></li>
<li>That value is <strong>always character</strong></li>
<li>The value is <strong>substituted directly into your program</strong></li>
</ul>
<p>A macro variable’s value can be:</p>
<ul>
<li>A variable name</li>
<li>A number</li>
<li>Text</li>
<li>Any string you want substituted into your SAS code</li>
</ul>
<p><strong>Macro</strong></p>
<p>A <strong>macro</strong> is a larger unit of code that can contain:</p>
<ul>
<li>DATA steps</li>
<li>PROC steps</li>
<li>Macro logic such as<br>
<code>%IF–%THEN–%ELSE</code>, <code>%DO–%END</code></li>
</ul>
<p>Macros often—but not always—use macro variables.</p>
</section>
</section>
<section id="think-globally-and-locally-scope-of-macro-variables" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="think-globally-and-locally-scope-of-macro-variables"><span class="header-section-number">9.5</span> Think Globally and Locally: Scope of Macro Variables</h2>
<p>Macro variables come in two scopes:</p>
<ul>
<li><strong>Local macro variables</strong></li>
<li><strong>Global macro variables</strong></li>
</ul>
<section id="local-macro-variables" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="local-macro-variables"><span class="header-section-number">9.5.1</span> Local Macro Variables</h3>
<ul>
<li>Defined <strong>inside a macro</strong></li>
<li>Exist <strong>only within that macro</strong></li>
<li>Cannot be referenced outside the macro</li>
</ul>
</section>
<section id="global-macro-variables" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="global-macro-variables"><span class="header-section-number">9.5.2</span> Global Macro Variables</h3>
<ul>
<li>Defined in <strong>open code</strong> (outside any macro)</li>
<li>Can be used <strong>anywhere in the program</strong></li>
</ul>
</section>
<section id="common-mistakes-to-avoid" class="level3" data-number="9.5.3">
<h3 data-number="9.5.3" class="anchored" data-anchor-id="common-mistakes-to-avoid"><span class="header-section-number">9.5.3</span> Common Mistakes to Avoid</h3>
<ul>
<li>Using a local macro variable outside its macro</li>
<li>Accidentally creating <strong>both local and global macro variables with the same name</strong></li>
</ul>
<p>Keeping scope in mind will save you a lot of debugging time.</p>
<div id="callout-2" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The macro processor <strong>does not resolve macro references inside single quotes</strong>.</p>
<ul>
<li>❌ <code>'&amp;var'</code> → macro not resolved</li>
<li>✅ <code>"&amp;var"</code> → macro resolved</li>
</ul>
<p><strong>Rule of thumb:</strong></p>
<blockquote class="blockquote">
<p>Use <strong>double quotes</strong> when quoted strings contain macro variables.</p>
</blockquote>
</div>
</div>
<p><strong>Substituting Text with <code>%LET</code></strong></p>
<p>The <code>%LET</code> statement assigns a value to a macro variable.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>%LET alpha <span class="ot">=</span> <span class="fl">0.05</span>;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>%MACRO <span class="fu">macro_name</span>(param1, param2, ..., paramk);</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   <span class="sc">/</span><span class="er">*</span> macro code <span class="sc">*</span><span class="er">/</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>%MEND macro_name;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="writing-sas-macros-with-car-dataset" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="writing-sas-macros-with-car-dataset"><span class="header-section-number">9.6</span> Writing SAS Macros with Car dataset</h2>
<p>Before writing our own macros, let us first understand how <strong>macro variables</strong> work through a simple example.</p>
<div class="callout-example" title="Car Dataset">
<p>SAS provides a built-in <strong>global macro variable</strong> called <code>SYSDATE</code>, which represents the system date.</p>
<p>Suppose we want to print the system date automatically in the title of a SAS report every time the report is generated. The advantage is that we do <strong>not</strong> need to manually update the date in the code. We use the built-in SAS dataset <code>CARS</code> from the <code>SASHELP</code> library.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA<span class="ot">=</span>SASHELP.CARS;</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  WHERE MAKE <span class="ot">=</span> <span class="st">'Audi'</span> AND TYPE <span class="ot">=</span> <span class="st">'Sports'</span>;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="figs/part2/L10_Macro/MACRO_car.png" class="img-fluid"></p>
<p>So far, we have used macro variables to make our SAS programs more flexible.<br>
Now we take one more step forward and define a <strong>macro program</strong>, which is a reusable block of SAS code. Macro variables are referenced in SAS statements using the ampersand (&amp;) character.</p>
<p>Now suppose we want our program to be more flexible. Instead of hard-coding the car MAKE and TYPE, we define macro variables so that we can easily change them without modifying multiple lines of code.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>%LET MAKE_NAME <span class="ot">=</span> Audi;</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>%LET TYPE_NAME <span class="ot">=</span> Sports;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA<span class="ot">=</span>SASHELP.CARS;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  WHERE MAKE <span class="ot">=</span> <span class="st">"&amp;MAKE_NAME"</span> AND TYPE <span class="ot">=</span> <span class="st">"&amp;TYPE_NAME"</span>;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="figs/part2/L10_Macro/MACRO_car.png" class="img-fluid"></p>
<p>Reusing the Same Program with Different Values</p>
<p>Now, suppose we want to view Audi vehicles of type Wagon. We only need to change one line of code.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">*</span> Change only the macro variable values <span class="sc">*</span><span class="er">/</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>%LET MAKE_NAME <span class="ot">=</span> <span class="st">'Audi'</span>;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>%LET TYPE_NAME <span class="ot">=</span> <span class="st">'Wagon'</span>;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">*</span> The SAS code below remains unchanged <span class="sc">*</span><span class="er">/</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA <span class="ot">=</span> SASHELP.CARS;</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    WHERE MAKE <span class="ot">=</span> <span class="er">&amp;</span>MAKE_NAME AND TYPE <span class="ot">=</span> <span class="er">&amp;</span>TYPE_NAME;</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="figs/part2/L10_Macro/MACRO_car3.png" class="img-fluid"></p>
<p><strong>More on Macro program</strong></p>
<p>The following program defines a macro called <code>show_result</code>.<br>
This macro takes two arguments:</p>
<ul>
<li><code>make_</code>: the car manufacturer</li>
<li><code>type_</code>: the vehicle type</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>%MACRO <span class="fu">show_result</span>(make_, type_);</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA<span class="ot">=</span>SASHELP.CARS;</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  WHERE MAKE <span class="ot">=</span> <span class="st">"&amp;make_"</span> AND TYPE <span class="ot">=</span> <span class="st">"&amp;type_"</span>;</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  TITLE <span class="st">"Sales as of &amp;SYSDAY &amp;SYSDATE"</span>;</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>RUN;</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>%MEND;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Calling a Macro Once a macro is defined, it can be called just like a function.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>%<span class="fu">show_result</span>(BMW, SUV);</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="figs/part2/L10_Macro/MACRO_car4.png" class="img-fluid"></p>
</div>
<p>So after seeing the first example, we have a more clear sense about why Use Macro Programs?</p>
<p>Macro programs allow you to:</p>
<ul>
<li>Avoid rewriting the same code repeatedly</li>
<li>Centralize logic in one place</li>
<li>Make programs easier to maintain and extend</li>
<li>Write data-driven and parameterized SAS programs</li>
</ul>
<p>This idea becomes especially powerful when we need to repeat the same analysis for many datasets or parameter values.</p>
</section>
<section id="revisit-the-one-sample-variance-test" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="revisit-the-one-sample-variance-test"><span class="header-section-number">9.7</span> Revisit the One-Sample Variance Test</h2>
<p>As discussed earlier, SAS does NOT provide a built-in procedure for conducting one-sample variance inference (confidence intervals or hypothesis tests). However, SAS allows us to overcome this limitation by writing our own macro procedures. Fortunately, a one-sample variance inference macro is commonly used and can be written in a general form. In this course, we will use a macro named <code>vartest.sas</code>, which is shared in the iCollege and below.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>%macro <span class="fu">vartest</span>(version,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span> _last_  ,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">var=</span>         ,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha=</span>  <span class="fl">0.05</span>   ,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">var0=</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sigma0=</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>              );</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="sc">%if &amp;version ne %</span>then %put VARTEST macro Version <span class="fl">1.1</span>;</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="sc">%let opts = %</span><span class="fu">sysfunc</span>(<span class="fu">getoption</span>(notes))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            _last_<span class="ot">=</span>%<span class="fu">sysfunc</span>(<span class="fu">getoption</span>(_last_));</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="sc">%if &amp;data=_last_ %</span>then %let data<span class="ot">=</span><span class="er">&amp;</span>syslast;</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>options nonotes;</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="sc">%if &amp;sigma0=0 or &amp;var0=0 %</span>then %do;</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  %put ERROR<span class="sc">:</span> The null hypothesis <span class="fu">variance</span> (<span class="at">VAR0=</span>) or standard deviation;</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%put %</span><span class="fu">str</span>(      ) (<span class="at">SIGMA0=</span>) must be greater than zero.;</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  %goto exit;</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>%end;</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>proc summary data<span class="ot">=</span><span class="er">&amp;</span>data;</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  var <span class="sc">&amp;</span>var;</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  output out<span class="ot">=</span><span class="fu">_varn</span>(<span class="at">keep=</span>var n std) n<span class="ot">=</span>n var<span class="ot">=</span>var std<span class="ot">=</span>std;</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>data _vartest;</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  set _varn;</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  df<span class="ot">=</span>n<span class="dv">-1</span>;</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%if &amp;sigma0 ne %</span>then %<span class="fu">str</span>(<span class="at">nullvar=</span><span class="sc">&amp;</span>sigma0 <span class="sc">*</span> <span class="er">&amp;</span>sigma0;);</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%if &amp;var0 ne %</span>then %<span class="fu">str</span>(<span class="at">nullvar=</span><span class="sc">&amp;</span>var0;);</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  level<span class="ot">=</span>(<span class="dv">1</span><span class="sc">-</span><span class="er">&amp;</span>alpha)<span class="sc">*</span><span class="dv">100</span>;</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  call <span class="fu">symput</span>(<span class="st">'level'</span>,<span class="fu">trim</span>(<span class="fu">left</span>(level)));</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%if &amp;sigma0 ne or &amp;var0 ne %</span>then %do;</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    chisq<span class="ot">=</span>((df)<span class="sc">*</span>(var))<span class="sc">/</span>nullvar;</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    pvalue<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">probchi</span>(chisq,df);</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  %end;</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  uclvar<span class="ot">=</span>df<span class="sc">*</span>var<span class="sc">/</span><span class="fu">cinv</span>(<span class="sc">&amp;</span>alpha<span class="sc">/</span><span class="dv">2</span>,df); uclstd<span class="ot">=</span><span class="fu">sqrt</span>(uclvar);</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  lclvar<span class="ot">=</span>df<span class="sc">*</span>var<span class="sc">/</span><span class="fu">cinv</span>(<span class="dv">1</span><span class="sc">-</span><span class="er">&amp;</span>alpha<span class="sc">/</span><span class="dv">2</span>,df); lclstd<span class="ot">=</span><span class="fu">sqrt</span>(lclvar);</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  label var<span class="ot">=</span><span class="st">"Sample Variance"</span> std<span class="ot">=</span><span class="st">"Sample Std Dev"</span> </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        chisq<span class="ot">=</span><span class="st">"Chi-Square"</span> pvalue<span class="ot">=</span><span class="st">"Prob&gt;Chi-Square"</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        level<span class="ot">=</span><span class="st">"Confidence Level (%)"</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        uclvar<span class="ot">=</span><span class="st">"UCL for Variance"</span> lclvar<span class="ot">=</span><span class="st">"LCL for Variance"</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        uclstd<span class="ot">=</span><span class="st">"UCL for Std Dev"</span> lclstd<span class="ot">=</span><span class="st">"LCL for Std Dev"</span>;</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  drop df  <span class="sc">%if &amp;sigma0 ne or &amp;var0 ne %</span>then nullvar;  ;</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>data _ci;</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  set _vartest;</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  stat<span class="ot">=</span><span class="st">"Variance"</span>; estimate<span class="ot">=</span>var; lcl<span class="ot">=</span>lclvar; ucl<span class="ot">=</span>uclvar; output;</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  stat<span class="ot">=</span><span class="st">"Std Dev"</span>;  estimate<span class="ot">=</span>std; lcl<span class="ot">=</span>lclstd; ucl<span class="ot">=</span>uclstd; output;</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  label stat<span class="ot">=</span><span class="st">"Statistic"</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        estimate<span class="ot">=</span><span class="st">"Estimate"</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        lcl<span class="ot">=</span><span class="st">"Lower Confidence Limit"</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        ucl<span class="ot">=</span><span class="st">"Upper Confidence Limit"</span>;</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  run;</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>proc print data<span class="ot">=</span>_ci label noobs;</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  var stat estimate lcl ucl;</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  title <span class="st">"&amp;level.% Confidence Intervals for Variance and Std Dev"</span>;</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  run;</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="sc">%if &amp;sigma0 ne or &amp;var0 ne %</span>then %do;</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>proc print data<span class="ot">=</span>_vartest label noobs;</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  var chisq pvalue;</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  format pvalue <span class="fl">6.4</span>;</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  title  <span class="st">"Hypothesis test for"</span>;</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  title2;</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a> <span class="sc">%if &amp;var0 ne %</span>then %do;</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  title3 <span class="st">"H0: Variance(%upcase(&amp;var)) = &amp;var0"</span>;</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  title4 <span class="st">"Ha: Variance(%upcase(&amp;var)) &gt; &amp;var0"</span>;</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a> %end;</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a> <span class="sc">%if &amp;sigma0 ne %</span>then %do;</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  title3 <span class="st">"H0: StdDev(%upcase(&amp;var)) = &amp;sigma0"</span>;</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  title4 <span class="st">"Ha: StdDev(%upcase(&amp;var)) &gt; &amp;sigma0"</span>;</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a> %end;</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>%end;</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>%exit<span class="sc">:</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>title;</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>options <span class="sc">&amp;</span>opts;</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>%mend;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>With this Marcro, we can implement it to construct the hypothesis testing or confidence interval for population variance <span class="math inline">\(\sigma^2\)</span>.</p>
<div class="callout-example" title="One-Sample Variance Test">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">*</span> Create a sample data set <span class="sc">*</span><span class="er">/</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>DATA DAT;</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    INPUT X <span class="sc">@</span><span class="er">@</span>;</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    DATALINES;</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fl">6.2</span> <span class="fl">1.9</span> <span class="fl">4.4</span> <span class="fl">4.9</span> <span class="fl">3.5</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fl">4.6</span> <span class="fl">4.2</span> <span class="fl">1.1</span> <span class="fl">1.3</span> <span class="fl">4.8</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fl">4.1</span> <span class="fl">3.7</span> <span class="fl">2.5</span> <span class="fl">3.7</span> <span class="fl">4.2</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fl">1.4</span> <span class="fl">3.2</span> <span class="fl">2.6</span> <span class="fl">1.5</span> <span class="fl">3.9</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>RUN;</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">*</span> Display the data <span class="sc">*</span><span class="er">/</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA <span class="ot">=</span> DAT;</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This dataset includes <strong>20 measurements</strong> of the length of a product from a manufacturing process. Again, our goal is to conduct <strong>statistical inference on the population variance</strong> of the product length. Specifically, we want to test whether the population variance is <strong>greater than 2.25</strong>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>DATA DAT;</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    INPUT X <span class="sc">@</span><span class="er">@</span>;</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    DATALINES;</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fl">6.2</span> <span class="fl">1.9</span> <span class="fl">4.4</span> <span class="fl">4.9</span> <span class="fl">3.5</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fl">4.6</span> <span class="fl">4.2</span> <span class="fl">1.1</span> <span class="fl">1.3</span> <span class="fl">4.8</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fl">4.1</span> <span class="fl">3.7</span> <span class="fl">2.5</span> <span class="fl">3.7</span> <span class="fl">4.2</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fl">1.4</span> <span class="fl">3.2</span> <span class="fl">2.6</span> <span class="fl">1.5</span> <span class="fl">3.9</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>RUN;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>PROC PRINT DATA <span class="ot">=</span> DAT;</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>RUN;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="using-the-vartst-macro-in-sas" class="level3" data-number="9.7.1">
<h3 data-number="9.7.1" class="anchored" data-anchor-id="using-the-vartst-macro-in-sas"><span class="header-section-number">9.7.1</span> Using the <code>VARTST</code> Macro in SAS</h3>
<p>Once the dataset has been created in SAS and the macro has been saved in a file with a known path, we can use the following code to conduct the <strong>one-sample variance test</strong> and construct the corresponding <strong>confidence intervals</strong>.</p>
<p>Use the <code>%INCLUDE</code> statement to load the macro into your SAS session:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">*</span> When using SAS Windows <span class="sc">*</span><span class="er">/</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>%INCLUDE </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">"C:/Users/cyeh/Desktop/Teaching/GSU/STAT8678-SAS/code/L10/vartest.sas"</span>;</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">*</span> <span class="cf">in</span> SAS studio <span class="sc">*</span><span class="er">/</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>%INCLUDE</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="st">"/home/u64378616/chikuang/Part2/L10_Marco/vartest.sas"</span>;</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>%<span class="fu">VARTST</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">DATA  =</span> DAT,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">VAR   =</span> X,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ALPHA =</span> <span class="fl">0.05</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">VAR0  =</span> <span class="fl">2.25</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><img src="figs/part2/L10_Macro/MACRO_var1.png" class="img-fluid"></p>
<p><img src="figs/part2/L10_Macro/MACRO_var2.png" class="img-fluid"></p>
</section>
</div>
<p>Question for you:</p>
<blockquote class="blockquote">
<p>How would you modify the macro call if you want to test whether the population standard deviation is greater than 1.5 instead of testing the population variance?</p>
</blockquote>
<div id="callout-3" class="callout callout-style-default callout-note callout-titled" title="Answer with Explanation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Answer with Explanation
</div>
</div>
<div class="callout-body-container callout-body">
<p>To calculate the p-value for <span class="math inline">\(H_1:\sigma^2 &lt; \sigma_0^2\)</span> and <span class="math inline">\(H_1:\sigma^2\ne \sigma_0^2\)</span> from the p-value for <span class="math inline">\(H_1: \sigma^2 &gt; \sigma_0^2\)</span>. We can do the following:</p>
<p>Let <span class="math inline">\(p\)</span> be the p-value for the right-tailed test <span class="math inline">\(H_1: \sigma^2 &gt; \sigma_0^2\)</span>.</p>
<ul>
<li>For the left-tailed test <span class="math inline">\(H_1: \sigma^2 &lt; \sigma_0^2\)</span>, the p-value is <span class="math inline">\(1-p\)</span>.</li>
<li>For the two-sided test <span class="math inline">\(H_1: \sigma^2 \ne \sigma_0^2\)</span>, the p-value is <span class="math inline">\(\min\{p, 1-p\} \times 2\)</span>.</li>
</ul>
<p><img src="figs/part2/L10_Macro/interval.png" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./part2_4_1sample_proportion_test.html" class="pagination-link" aria-label="One Sample Proportion Test">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">One Sample Proportion Test</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./part2_6_chi-square.html" class="pagination-link" aria-label="$\chi^2$ Goodness of Fit Test">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><span class="math inline">\(\chi^2\)</span> Goodness of Fit Test</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>